<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>official music fan club</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
		<div id="container"></div>
		<script type="module">
import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.min.js';
import { EffectComposer } from 'https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/postprocessing/EffectComposer.js';
import { RenderPass } from 'https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/postprocessing/RenderPass.js';
import { OutlinePass } from 'https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/postprocessing/OutlinePass.js';
import { AfterimagePass } from 'https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/postprocessing/AfterimagePass.js';

// global objects
let plane = null;
let planeXRot = 0;
let planeYRot = 0;
let outlinePass;

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera( 120, window.innerWidth / window.innerHeight, 0.1, 1000 );
camera.position.set(0, 0, 1);

const renderer = new THREE.WebGLRenderer();
renderer.setPixelRatio( window.devicePixelRatio );

const composer = new EffectComposer( renderer );
composer.addPass( new RenderPass( scene, camera ) );
//composer.addPass( new AfterimagePass() );

document.getElementById( 'container' ).appendChild( renderer.domElement );
window.addEventListener( 'resize', onWindowResize, false );
window.addEventListener( 'mousemove', onMouseMove, false );

async function init() {
    const geometry = new THREE.PlaneGeometry( 1, 1 );
    const material = new THREE.MeshBasicMaterial( {color: 0x000000, side: THREE.DoubleSide} );
    plane = new THREE.Mesh( geometry, material );
    scene.add( plane );
    const outlinePass = new OutlinePass(new THREE.Vector2(window.innerWidth, window.innerHeight), scene, camera, [plane]);
    outlinePass.edgeStrength = 8;
    outlinePass.visibleEdgeColor.set('#ffffff');
    composer.addPass( outlinePass );
    console.log(composer);
    onWindowResize();
}

function animate() {
    setTimeout(() => {
        requestAnimationFrame(animate);
    }, 1000 / 60);
    const time = performance.now() * 0.001;
    if (plane != null) {
        plane.rotation.x = (plane.rotation.x*5 + planeXRot) / 6;
        plane.rotation.y = (plane.rotation.y*5 + planeYRot) / 6;
    }
    composer.render();
}

function onWindowResize() {
    let width, height;
    if (window.visualViewport != undefined) {
        width = window.visualViewport.width;
        height = window.visualViewport.height;
    } else {
        width = window.innerWidth;
        height = window.innerHeight;
    }
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
    renderer.setSize( width, height );
    composer.setSize( width, height );
    // resize plane to fit in canvas
    if (plane != null) {
        const vFOV = THREE.MathUtils.degToRad( camera.fov );
        const visHeight = 2 * Math.tan( vFOV / 2 );
        const visWidth = visHeight * camera.aspect;
        plane.scale.set((width - 40) / width * visWidth, (height - 40) / height * visHeight, 1);
    }
}

function onMouseMove(event) {
    const size = new THREE.Vector2();
    renderer.getSize(size);
    const width = size.x;
    const height = size.y;
    planeYRot = (event.clientX - width/2) / width / 50;
    planeXRot = (event.clientY - height/2) / height / 50;
}


init();
animate();
        </script>
	</body>
</html>